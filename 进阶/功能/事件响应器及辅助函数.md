# 事件响应器及其辅助函数

>Warning
本章节为[事件响应器](../../教程/插件开发（基础）/02_事件响应器.md)的拓展内容，请务必在阅读并理解之后再阅读本节内容。

## 事件响应器的参数

### 通用参数

事件响应器的通用参数为任何事件响应器的辅助函数均支持的参数。

#### 事件响应规则-rule

事件响应器的响应规则是一个 `Rule` 对象，它是一系列 `checker` 的集合，当所有的 `checker` 都返回 `True` 时，才会触发该响应器。

```py
on_command(rule=Rule(_checker))
```

详情请参考[教程 - 自定义规则](../../教程/插件开发（高级）/自定义规则.md)。

#### 事件处理函数列表-handler

事件处理函数列表是一个 `List[Union[T_Handler, Dependent]]` 对象，其中存放着该事件响应器的事件处理函数。通常我们会选择[事件响应器的依赖处理装饰器](../../教程/插件开发（基础）/03_事件处理流程.md#处理依赖)来添加依赖，而较少直接在事件响应器的注册阶段进行修改。

#### 临时事件响应器-temp

临时事件响应器是一个 `bool` 对象，声明该事件响应器为临时事件响应器，该事件响应器在触发过一次后便会被销毁。在事件响应器被销毁后仍可重新注册响应器。

```py
on_command(temp=True)
```

#### 有效期-expire_time

有效期是一个 `int` 对象，为事件响应器设置有效期（或过期时间），在超出有效期后无法再次触发该响应器并销毁。在事件响应器被销毁后仍可重新注册响应器。

```py
on_command(expire_time=60)
```

#### 优先级-priority

优先级是一个 `int` 对象，事件响应器的优先级代表事件响应器的执行顺序。默认的优先级为 `1`。

同一优先级的事件响应器会**同时执行**，优先级数字**越小**越先响应！优先级请从 `1` 开始排序！

```py
on_command(priority=10)
```

#### 阻断-block

阻断是一个 `bool` 对象，当有任意事件响应器发出了阻止事件传递信号时，该事件将不再会传递给下一优先级，直接结束处理。

NoneBot 内置的事件响应器中，所有非 `command` 规则的 `message` 类型的事件响应器都会阻断事件传递，其他则不会。

```py
on_command(block=True)
```

#### 上下文-state

事件响应器的上下文是一个 `T_State` 对象，即 `Dict[Any, Any]` 对象，用于存放一个事件处理流程中的上下文信息。在事件响应器被触发后，会将此处传入的state并入该事件处理流程的上下文信息中。

```py
on_command(state={'key':'value'})
```

详情请参考[进阶 - 依赖注入](./依赖注入.md#state)。

<!-- TODO: 补充进阶内容的链接 -->

### 特殊参数

事件响应器的特殊参数为部分响应器支持的参数。在使用此部分参数前请务必参考[事件响应器的辅助函数](#事件响应器的辅助函数)中列出的可用范围。

#### 事件类型-type

事件类型即是该响应器所要响应的事件类型，只有在接收到的事件类型与该响应器的类型相同时，才会触发该响应器。如果类型留空，该响应器将会响应所有类型的事件。目前**仅有** [`on`](#on) 含有此参数。

NoneBot 内置了四种主要类型：`meta_event`、`message`、`notice`、`request`。通常情况下，协议适配器会将事件合理地分类至这四种类型中。如果有其他类型的事件需要响应，可以自行定义新的类型。

```py
on('message')
on('custom_type')
```

#### 事件响应权限-permission

事件响应器的响应权限是一个 `Permission` 对象，它也是一系列 `checker` 的集合，当其中一个 `checker` 返回 `True` 时，就会触发该响应器。目前**除** [`on_metaevent`](#on_metaevent)、[`on_request`](#on_request) 和 [`on_notice`](#on_notice) **之外**的辅助函数均含有此参数。

```py
on_command(permission=SUPERUSER)
```

详情请参考[教程 - 权限控制](../../教程/插件开发（基础）/06_权限控制.md)。

#### msg/cmd

`msg` 和 `cmd` 均为 `Union[str, Tuple[str, ...]]` 对象，用于匹配消息事件的内容。在不同的辅助函数中匹配模式也有所不同。如果事件响应器的辅助函数包含此参数，**此参数为必填参数**。

```py
on_command('cmd_arg')
on_fullmatch('msg_arg')
```

`msg` 和 `cmd` 的区别在于，包含 `cmd` 参数的辅助函数所生成的事件响应器会额外匹配 `命令头`，详情可参考[配置项](./配置项.md)

#### keywords

#### aliases

#### ignorecase

#### parser

`nonebot.rule.ArgumentParser` 对象

#### pattern

#### flags

## 事件响应器的辅助函数

### `on`

注册一个基础事件响应器，可自定义响应的消息类型。

可用参数：

- [type](#事件响应器类型-type)(特殊)
- [rule](#事件响应规则-rule)
- [permission](#事件响应权限-permission)(特殊)
- [handlers](#事件处理函数列表-handler)
- [temp](#临时事件-temp)
- [expire_time](#有效期-expire_time)
- [priority](#优先级-priority)
- [block](#阻断-block)
- [state](#上下文-state)

### `on_metaevent`

注册一个元事件响应器。

可用参数：

- [rule](#事件响应规则-rule)
- [handlers](#事件处理函数列表-handler)
- [temp](#临时事件-temp)
- [expire_time](#有效期-expire_time)
- [priority](#优先级-priority)
- [block](#阻断-block)
- [state](#上下文-state)

### `on_request`

注册一个请求事件响应器。

可用参数：

- [rule](#事件响应规则-rule)
- [handlers](#事件处理函数列表-handler)
- [temp](#临时事件-temp)
- [expire_time](#有效期-expire_time)
- [priority](#优先级-priority)
- [block](#阻断-block)
- [state](#上下文-state)

### `on_notice`

注册一个通知事件响应器。

可用参数：

- [rule](#事件响应规则-rule)
- [handlers](#事件处理函数列表-handler)
- [temp](#临时事件-temp)
- [expire_time](#有效期-expire_time)
- [priority](#优先级-priority)
- [block](#阻断-block)
- [state](#上下文-state)

### `on_message`

注册一个消息事件响应器。

可用参数：

- [rule](#事件响应规则-rule)
- [permission](#事件响应权限-permission)(特殊)
- [handlers](#事件处理函数列表-handler)
- [temp](#临时事件-temp)
- [expire_time](#有效期-expire_time)
- [priority](#优先级-priority)
- [block](#阻断-block)
- [state](#上下文-state)

### `on_startswith`

注册一个消息事件响应器，并且当消息的**文本部分**以指定内容开头时响应。

可用参数：

- [msg](#msgcmd)(特殊)(必填)
- [rule](#事件响应规则-rule)
- [ignorecase](#ignorecase)(特殊)
- [permission](#事件响应权限-permission)(特殊)
- [handlers](#事件处理函数列表-handler)
- [temp](#临时事件-temp)
- [expire_time](#有效期-expire_time)
- [priority](#优先级-priority)
- [block](#阻断-block)
- [state](#上下文-state)

### `on_endswith`

注册一个消息事件响应器，并且当消息的**文本部分**以指定内容结尾时响应。

可用参数：

- [msg](#msgcmd)(特殊)(必填)
- [rule](#事件响应规则-rule)
- [ignorecase](#ignorecase)(特殊)
- [permission](#事件响应权限-permission)(特殊)
- [handlers](#事件处理函数列表-handler)
- [temp](#临时事件-temp)
- [expire_time](#有效期-expire_time)
- [priority](#优先级-priority)
- [block](#阻断-block)
- [state](#上下文-state)

### `on_fullmatch`

注册一个消息事件响应器，并且当消息的**文本部分**与指定内容完全一致时响应。

可用参数：

- [msg](#msgcmd)(特殊)(必填)
- [rule](#事件响应规则-rule)
- [ignorecase](#ignorecase)(特殊)
- [permission](#事件响应权限-permission)(特殊)
- [handlers](#事件处理函数列表-handler)
- [temp](#临时事件-temp)
- [expire_time](#有效期-expire_time)
- [priority](#优先级-priority)
- [block](#阻断-block)
- [state](#上下文-state)

### `on_keyword`

注册一个消息事件响应器，并且当消息纯文本部分包含关键词时响应。

可用参数：

- [keywords](#keywords)(特殊)(必填)
- [rule](#事件响应规则-rule)
- [permission](#事件响应权限-permission)(特殊)
- [handlers](#事件处理函数列表-handler)
- [temp](#临时事件-temp)
- [expire_time](#有效期-expire_time)
- [priority](#优先级-priority)
- [block](#阻断-block)
- [state](#上下文-state)

### `on_command`

注册一个消息事件响应器，并且当消息以指定命令开头时响应。

命令匹配规则参考: `命令形式匹配 <rule.md#command-command>`_

可用参数：

- [cmd](#msgcmd)(特殊)(必填)
- [rule](#事件响应规则-rule)
- [aliases](#aliases)(特殊)
- [permission](#事件响应权限-permission)(特殊)
- [handlers](#事件处理函数列表-handler)
- [temp](#临时事件-temp)
- [expire_time](#有效期-expire_time)
- [priority](#优先级-priority)
- [block](#阻断-block)
- [state](#上下文-state)

### `on_shell_command`

注册一个支持 `shell_like` 解析参数的命令消息事件响应器。

与普通的 `on_command` 不同的是，在添加 `parser` 参数时, 响应器会自动处理消息。

并将用户输入的原始参数列表保存在 `state["argv"]`, `parser` 处理的参数保存在 `state["args"]` 中

可用参数：

- [cmd](#msgcmd)(特殊)(必填)
- [rule](#事件响应规则-rule)
- [aliases](#aliases)(特殊)
- [parser](#parser)(特殊)
- [permission](#事件响应权限-permission)(特殊)
- [handlers](#事件处理函数列表-handler)
- [temp](#临时事件-temp)
- [expire_time](#有效期-expire_time)
- [priority](#优先级-priority)
- [block](#阻断-block)
- [state](#上下文-state)

### `on_regex`

注册一个消息事件响应器，并且当消息匹配正则表达式时响应。

命令匹配规则参考: `正则匹配 <rule.md#regex-regex-flags-0>`_

可用参数：

- [pattern](#pattern)(特殊)(必填)
- [flags](#flags)(特殊)
- [rule](#事件响应规则-rule)
- [permission](#事件响应权限-permission)(特殊)
- [handlers](#事件处理函数列表-handler)
- [temp](#临时事件-temp)
- [expire_time](#有效期-expire_time)
- [priority](#优先级-priority)
- [block](#阻断-block)
- [state](#上下文-state)

### `CommandGroup`

### `MatcherGroup`

其中，`on_metaevent` `on_message` `on_request` `on_notice` 函数都是在 `on` 的基础上添加了对应的事件类型 `type`；`on_startswith` `on_endswith` `on_fullmatch` `on_keyword` `on_command` `on_shell_command` `on_regex` 函数都是在 `on_message` 的基础上添加了对应的匹配规则 `rule`。
